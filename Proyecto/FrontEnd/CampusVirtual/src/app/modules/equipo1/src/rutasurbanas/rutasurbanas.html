<div class="container mt-4">
  <h2>Rutas urbanas</h2>
  <p class="text-muted">
    Consulta rÃ¡pida de la Ruta Arteaga y el Lobus UAdeC.
  </p>

  <!-- Filtros -->
  <form class="row g-2 align-items-end mb-3" (ngSubmit)="cargarRutas()">
    <div class="col-auto">
      <label class="form-label mb-1">Tipo</label>
      <select
        class="form-select"
        [(ngModel)]="filtroTipo"
        name="tipo"
      >
        <option value="">Todas</option>
        <option value="urbana">Urbana</option>
        <option value="escolar">Escolar</option>
      </select>
    </div>

    <div class="col-auto">
      <label class="form-label mb-1">Buscar</label>
      <input
        class="form-control"
        [(ngModel)]="filtroTexto"
        name="q"
        placeholder="Arteaga, Lobus, Sistemas..."
      />
    </div>

    <div class="col-auto">
      <button
        type="submit"
        class="btn btn-primary me-2"
        [disabled]="cargando"
      >
        {{ cargando ? 'Buscando...' : 'Aplicar filtros' }}
      </button>

      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="limpiarFiltros()"
        [disabled]="cargando"
      >
        Limpiar
      </button>
    </div>
  </form>

  <!-- Mensajes -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="!error && rutas.length === 0 && !cargando" class="alert alert-info">
    No se encontraron rutas con esos filtros.
  </div>

  <div class="row">
    <!-- Lista de rutas -->
    <div class="col-md-6">
      <div *ngIf="cargando" class="text-muted mb-2">
        Cargando rutas...
      </div>

      <div
        *ngFor="let ruta of rutas"
        class="card mb-2"
        (click)="verDetalle(ruta)"
        style="cursor: pointer;"
      >
        <div class="card-body">
          <h5 class="card-title mb-1">{{ ruta.nombre }}</h5>

          <span class="badge bg-primary text-uppercase me-2">
            {{ ruta.tipo }}
          </span>

          <!-- Frecuencia normal para todas menos Lobus -->
          <small class="text-muted" *ngIf="ruta.id !== 'lobus'">
            Cada {{ ruta.frecuencia_min }} min
          </small>

          <!-- Texto especial para Lobus -->
          <small class="text-muted" *ngIf="ruta.id === 'lobus'">
            Horarios: 6:30 a 7:30, 12:30 a 2:30, 12:50â€“1:10, 3:30â€“4:10, 8:30â€“9:30
          </small>

          <p class="mt-2 mb-0">
            <strong>Paradas principales:</strong>
            {{ ruta.paradas_principales.join(' â†’ ') }}
          </p>
        </div>
      </div>
    </div>

    <!-- Detalle de la ruta seleccionada -->
    <div class="col-md-6" *ngIf="rutaSeleccionada">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">{{ rutaSeleccionada.nombre }}</h4>

          <p class="mb-1">
            <strong>Tipo:</strong> {{ rutaSeleccionada.tipo }}
          </p>

          <p class="mb-1" *ngIf="rutaSeleccionada.id !== 'lobus'">
            <strong>Frecuencia:</strong> cada {{ rutaSeleccionada.frecuencia_min }} minutos
          </p>

          <p class="mb-1" *ngIf="rutaSeleccionada.id === 'lobus'">
            <strong>Horarios del Lobus:</strong><br />
            6:30 a 7:30<br />
            12:30 a 2:30<br />
            12:50 a 1:10<br />
            3:30 a 4:10<br />
            8:30 a 9:30
          </p>

          <p class="mb-1" *ngIf="rutaSeleccionada.id !== 'lobus'">
            <strong>Horarios:</strong><br />
            DÃ­as hÃ¡biles:
            {{ rutaSeleccionada.horarios?.dias_habiles || 'N/D' }}<br />
            SÃ¡bado: {{ rutaSeleccionada.horarios?.sabado || 'N/D' }}<br />
            Domingo: {{ rutaSeleccionada.horarios?.domingo || 'N/D' }}
          </p>

          <p class="mb-1">
            <strong>Paradas:</strong>
          </p>
          <ul class="mb-2">
            <li *ngFor="let p of rutaSeleccionada.paradas_principales">
              {{ p }}
            </li>
          </ul>

          <!-- ðŸ‘‡ AquÃ­ usamos PNG/JPG en lugar de iframe -->
          <div class="mt-3">
            <ng-container [ngSwitch]="rutaSeleccionada.id">
              <img
                *ngSwitchCase="'arteaga'"
                src="/assets/images/rutas/ARTEAGA.png"
                alt="Mapa Ruta Arteaga"
                class="img-fluid rounded border"
              />

              <img
                *ngSwitchCase="'lobus'"
                src="/assets/images/rutas/LOBUS.jpg"
                alt="Mapa Lobus UAdeC"
                class="img-fluid rounded border"
              />

              <small *ngSwitchDefault class="text-muted">
                Mapa prÃ³ximamenteâ€¦
              </small>
            </ng-container>
          </div>
          
        </div>
      </div>
    </div>

  </div>
</div>
